<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V2Ray Turbo & Access Checker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap');
        body { font-family: 'Vazirmatn', sans-serif; background-color: #0f172a; color: #f8fafc; }
        .card { background: #1e293b; border: 1px solid #334155; border-radius: 1.5rem; }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-5xl mx-auto space-y-6">
        
        <div class="card p-6 border-blue-500/50 shadow-lg shadow-blue-500/10">
            <h2 class="text-xl font-bold text-blue-400 mb-4 flex items-center gap-2">
                ğŸš€ ØªØ³Øª Ø¯Ø³ØªØ±Ø³ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ (Ø¨Ø¹Ø¯ Ø§Ø² Ø§ØªØµØ§Ù„ Ø¨Ù‡ VPN)
            </h2>
            <p class="text-xs text-slate-400 mb-6">Ø§Ø¨ØªØ¯Ø§ Ø¯Ø± Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø®ÙˆØ¯ Ø¨Ù‡ ÛŒÚ© Ú©Ø§Ù†ÙÛŒÚ¯ ÙˆØµÙ„ Ø´ÙˆÛŒØ¯ØŒ Ø³Ù¾Ø³ Ø¯Ú©Ù…Ù‡ Ø²ÛŒØ± Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯ ØªØ§ Ø³Ø±Ø¹Øª ÙˆØ§Ù‚Ø¹ÛŒ ÛŒÙˆØªÛŒÙˆØ¨ Ùˆ Ú¯ÙˆÚ¯Ù„ Ú†Ú© Ø´ÙˆØ¯.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-slate-900/50 p-4 rounded-2xl text-center border border-slate-700">
                    <span class="text-xs text-slate-500 block mb-1">YouTube</span>
                    <b id="yt-status" class="text-sm">---</b>
                </div>
                <div class="bg-slate-900/50 p-4 rounded-2xl text-center border border-slate-700">
                    <span class="text-xs text-slate-500 block mb-1">Google</span>
                    <b id="google-status" class="text-sm">---</b>
                </div>
                <button onclick="checkRealInternet()" id="realTestBtn" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 rounded-2xl transition shadow-lg shadow-emerald-900/20">
                    Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø§ØªØµØ§Ù„
                </button>
            </div>
        </div>

        <div class="card p-6">
            <h2 class="text-lg font-bold text-slate-300 mb-4">Û±. Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ùˆ ÙÛŒÙ„ØªØ± Ø§ÙˆÙ„ÛŒÙ‡ (Ù¾ÛŒÙ†Ú¯ Ø³Ø±ÙˆØ±)</h2>
            <textarea id="subLinks" rows="3" class="w-full bg-slate-900 border border-slate-700 rounded-xl p-4 text-xs mb-4 outline-none focus:ring-2 focus:ring-blue-500 font-mono" dir="ltr" placeholder="Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø¨ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..."></textarea>
            
            <div class="flex flex-col md:flex-row gap-4 mb-6">
                <input type="number" id="pingLimit" value="800" class="flex-1 bg-slate-900 border border-slate-700 rounded-xl p-3 text-sm text-center font-bold text-emerald-400">
                <button onclick="startTurboTest()" id="mainBtn" class="flex-[2] bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-xl font-bold transition">Ø´Ø±ÙˆØ¹ Ù¾ÛŒÙ†Ú¯ Ø³Ø±ÛŒØ¹</button>
            </div>

            <div class="grid grid-cols-3 gap-2 text-center text-[10px] md:text-xs">
                <div class="bg-slate-900 p-2 rounded-lg">Ú©Ù„: <b id="total" class="text-blue-400">0</b></div>
                <div class="bg-slate-900 p-2 rounded-lg">ØªØ³Øª: <b id="tested" class="text-yellow-400">0</b></div>
                <div class="bg-slate-900 p-2 rounded-lg text-emerald-400">Ø³Ø§Ù„Ù…: <b id="healthy">0</b></div>
            </div>
        </div>

        <div class="card overflow-hidden">
            <div class="max-h-[400px] overflow-y-auto">
                <table class="w-full text-right text-xs md:text-sm">
                    <thead class="bg-slate-900/80 sticky top-0 text-slate-500">
                        <tr>
                            <th class="p-4">Ù†Ø§Ù… Ú©Ø§Ù†ÙÛŒÚ¯</th>
                            <th class="p-4 text-center">Ù¾ÛŒÙ†Ú¯ Ø³Ø±ÙˆØ±</th>
                        </tr>
                    </thead>
                    <tbody id="resultTable" class="divide-y divide-slate-700/50"></tbody>
                </table>
            </div>
        </div>

        <button onclick="copyAll()" id="copyBtn" class="w-full bg-emerald-600 py-4 rounded-2xl font-bold hidden shadow-xl">Ú©Ù¾ÛŒ Ù…ÙˆØ§Ø±Ø¯ Ø¨Ø§ Ù¾ÛŒÙ†Ú¯ Ù…Ù†Ø§Ø³Ø¨</button>
    </div>

    <script>
        const PROXY_WORKer = "https://sub-proxy.task132141.workers.dev/";
        let healthyConfigs = [];

        // --- ØªØ³Øª Ø¯Ø³ØªØ±Ø³ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ (YouTube & Google) ---
        async function checkRealInternet() {
            const btn = document.getElementById('realTestBtn');
            const ytLabel = document.getElementById('yt-status');
            const gLabel = document.getElementById('google-status');

            btn.disabled = true;
            btn.innerText = "Ø¯Ø±Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ...";
            ytLabel.innerText = "â³..."; gLabel.innerText = "â³...";

            const testSite = async (url, label) => {
                const start = Date.now();
                try {
                    // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² no-cors Ø¨Ø±Ø§ÛŒ Ø§Ø¬ØªÙ†Ø§Ø¨ Ø§Ø² Ø®Ø·Ø§ÛŒ CORSØŒ Ø§Ú¯Ø± Ù„ÙˆØ¯ Ø´ÙˆØ¯ ÛŒØ¹Ù†ÛŒ ÙˆÛŒâ€ŒÙ¾ÛŒâ€ŒØ§Ù† ÙˆØµÙ„ Ø§Ø³Øª
                    await fetch(url, { mode: 'no-cors', cache: 'no-cache', signal: AbortSignal.timeout(5000) });
                    const delay = Date.now() - start;
                    label.innerText = `âœ… ÙˆØµÙ„ (${delay}ms)`;
                    label.className = "text-emerald-400";
                } catch {
                    label.innerText = "âŒ Ù‚Ø·Ø¹";
                    label.className = "text-red-500";
                }
            };

            await Promise.all([
                testSite('https://www.youtube.com/favicon.ico', ytLabel),
                testSite('https://www.google.com/favicon.ico', gLabel)
            ]);

            btn.disabled = false;
            btn.innerText = "Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø¬Ø¯Ø¯";
        }

        // --- ØªØ³ØªØ± ØªÙˆØ±Ø¨Ùˆ (Ù‡Ù…Ø§Ù† Ù…Ù†Ø·Ù‚ Ø³Ø±ÛŒØ¹ Ù‚Ø¨Ù„ÛŒ) ---
        let testedCount = 0;
        async function startTurboTest() {
            const subInput = document.getElementById('subLinks').value.trim();
            const btn = document.getElementById('mainBtn');
            const table = document.getElementById('resultTable');
            if (!subInput) return alert("Ù„ÛŒÙ†Ú© Ø³Ø§Ø¨ Ú©ÙˆØŸ");

            btn.disabled = true; btn.innerText = "Ø¯Ø±Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª...";
            table.innerHTML = ""; healthyConfigs = []; testedCount = 0;

            try {
                const response = await fetch(`${PROXY_WORKer}?url=${encodeURIComponent(subInput)}`);
                const rawData = await response.text();
                let decoded = "";
                try { decoded = atob(rawData.trim().replace(/_/g, '/').replace(/-/g, '+').replace(/\s/g, '')); } catch { decoded = rawData; }
                
                const allConfigs = decoded.split(/\r?\n/).filter(line => line.includes('://'));
                document.getElementById('total').innerText = allConfigs.length;

                // Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ù‡Ù…Ø²Ù…Ø§Ù† (Parallel)
                const queue = [...allConfigs];
                const workers = Array(15).fill(0).map(() => (async () => {
                    while (queue.length > 0) {
                        const conf = queue.shift();
                        await testConfig(conf, allConfigs.length);
                    }
                })());
                await Promise.all(workers);
            } catch (err) { alert("Ø®Ø·Ø§ Ø¯Ø± Ø³Ø§Ø¨â€ŒÙ„ÛŒÙ†Ú©!"); }
            btn.disabled = false; btn.innerText = "Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯";
            if(healthyConfigs.length > 0) document.getElementById('copyBtn').classList.remove('hidden');
        }

        async function testConfig(conf, total) {
            let address = "", name = "Config";
            try {
                if (conf.startsWith('vmess://')) {
                    const json = JSON.parse(atob(conf.replace('vmess://', '')));
                    address = json.add; name = json.ps;
                } else {
                    const urlObj = new URL(conf);
                    address = urlObj.hostname;
                    name = decodeURIComponent(conf.split('#')[1] || "Config");
                }

                const row = document.getElementById('resultTable').insertRow(0);
                const nCell = row.insertCell(0);
                const pCell = row.insertCell(1);
                nCell.className = "p-4 truncate max-w-[200px]";
                pCell.className = "p-4 text-center font-mono";
                nCell.innerText = name; pCell.innerText = "...";

                const start = Date.now();
                try {
                    await fetch(`https://${address}`, { mode: 'no-cors', cache: 'no-cache', signal: AbortSignal.timeout(3000) });
                    const delay = Date.now() - start;
                    pCell.innerText = delay + "ms";
                    if (delay <= parseInt(document.getElementById('pingLimit').value)) {
                        pCell.className += " text-emerald-400";
                        healthyConfigs.push(conf);
                    }
                } catch { pCell.innerText = "âŒ"; pCell.className += " text-red-500"; }
            } catch (e) {} finally {
                testedCount++;
                document.getElementById('tested').innerText = testedCount;
                document.getElementById('healthy').innerText = healthyConfigs.length;
            }
        }

        function copyAll() {
            navigator.clipboard.writeText(healthyConfigs.join('\n'));
            alert("Ú©Ù¾ÛŒ Ø´Ø¯!");
        }
    </script>
</body>
</html>
